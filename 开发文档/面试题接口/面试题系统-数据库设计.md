# 面试题系统数据库设计文档

## 1. 数据库设计概述

### 1.1 设计原则
- 遵循第三范式，确保数据一致性
- 合理使用索引，优化查询性能
- 预留扩展字段，支持未来需求
- 采用逻辑删除，保留数据历史

### 1.2 命名规范
- 表名：interview_前缀 + 功能描述，使用下划线分隔
- 字段名：小写字母，下划线分隔
- 主键：id (BIGINT)
- 时间字段：create_time, update_time
- 逻辑删除：is_deleted

## 2. 核心数据表设计

### 2.1 分类表 (interview_category)

```sql
CREATE TABLE `interview_category` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `parent_id` BIGINT DEFAULT 0 COMMENT '父分类ID，0表示顶级分类',
  `category_name` VARCHAR(100) NOT NULL COMMENT '分类名称',
  `category_path` VARCHAR(500) COMMENT '分类路径，如：/Java基础/集合',
  `description` TEXT COMMENT '分类描述',
  `icon` VARCHAR(100) COMMENT '分类图标',
  `sort_order` INT DEFAULT 0 COMMENT '排序序号',
  `question_count` INT DEFAULT 0 COMMENT '题目数量',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用，1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  INDEX `idx_parent_id` (`parent_id`),
  INDEX `idx_sort_order` (`sort_order`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='面试题分类表';
```

### 2.2 面试题主表 (interview_question)

```sql
CREATE TABLE `interview_question` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `category_id` BIGINT NOT NULL COMMENT '分类ID',
  `title` VARCHAR(500) NOT NULL COMMENT '题目标题',
  `content` LONGTEXT NOT NULL COMMENT '题目内容（Markdown格式）',
  `content_html` LONGTEXT COMMENT '题目内容（HTML格式，用于展示）',
  `difficulty` TINYINT DEFAULT 1 COMMENT '难度：1-简单，2-中等，3-困难',
  `source` VARCHAR(200) COMMENT '题目来源',
  `source_url` VARCHAR(500) COMMENT '原文链接',
  `file_path` VARCHAR(500) COMMENT '原始文件路径',
  `view_count` INT DEFAULT 0 COMMENT '浏览次数',
  `like_count` INT DEFAULT 0 COMMENT '点赞次数',
  `collect_count` INT DEFAULT 0 COMMENT '收藏次数',
  `comment_count` INT DEFAULT 0 COMMENT '评论次数',
  `sort_order` INT DEFAULT 0 COMMENT '排序序号',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-草稿，1-发布，2-归档',
  `import_time` DATETIME COMMENT '导入时间',
  `last_update_time` DATETIME COMMENT '最后更新时间（来源文件）',
  `create_by` BIGINT COMMENT '创建人ID',
  `update_by` BIGINT COMMENT '更新人ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  INDEX `idx_category_id` (`category_id`),
  INDEX `idx_difficulty` (`difficulty`),
  INDEX `idx_status` (`status`),
  INDEX `idx_sort_order` (`sort_order`),
  FULLTEXT INDEX `ft_title_content` (`title`, `content`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='面试题主表';
```

### 2.3 标签表 (interview_tag)

```sql
CREATE TABLE `interview_tag` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `tag_name` VARCHAR(50) NOT NULL COMMENT '标签名称',
  `tag_type` TINYINT DEFAULT 1 COMMENT '标签类型：1-技术，2-公司，3-岗位，4-其他',
  `use_count` INT DEFAULT 0 COMMENT '使用次数',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_tag_name` (`tag_name`),
  INDEX `idx_tag_type` (`tag_type`),
  INDEX `idx_use_count` (`use_count`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='面试题标签表';
```

### 2.4 题目标签关联表 (interview_question_tag)

```sql
CREATE TABLE `interview_question_tag` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `tag_id` BIGINT NOT NULL COMMENT '标签ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_question_tag` (`question_id`, `tag_id`),
  INDEX `idx_question_id` (`question_id`),
  INDEX `idx_tag_id` (`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='题目标签关联表';
```

## 3. 用户学习相关表

### 3.1 学习进度表 (interview_study_progress)

```sql
CREATE TABLE `interview_study_progress` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `category_id` BIGINT NOT NULL COMMENT '分类ID（冗余字段，提高查询效率）',
  `study_status` TINYINT DEFAULT 0 COMMENT '学习状态：0-未学习，1-学习中，2-已掌握',
  `difficulty_rating` TINYINT COMMENT '个人难度评级：1-5星',
  `importance_rating` TINYINT COMMENT '重要性评级：1-5星',
  `study_count` INT DEFAULT 0 COMMENT '学习次数',
  `total_study_time` INT DEFAULT 0 COMMENT '总学习时长（秒）',
  `last_study_time` DATETIME COMMENT '最后学习时间',
  `mastery_time` DATETIME COMMENT '掌握时间',
  `next_review_time` DATETIME COMMENT '下次复习时间',
  `review_count` INT DEFAULT 0 COMMENT '复习次数',
  `is_marked` TINYINT DEFAULT 0 COMMENT '是否标记：0-否，1-是',
  `mark_reason` VARCHAR(200) COMMENT '标记原因',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_user_question` (`user_id`, `question_id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_question_id` (`question_id`),
  INDEX `idx_category_id` (`category_id`),
  INDEX `idx_study_status` (`study_status`),
  INDEX `idx_next_review_time` (`next_review_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习进度表';
```

### 3.2 用户笔记表 (interview_user_note)

```sql
CREATE TABLE `interview_user_note` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `note_content` TEXT NOT NULL COMMENT '笔记内容（Markdown格式）',
  `note_html` TEXT COMMENT '笔记内容（HTML格式）',
  `is_public` TINYINT DEFAULT 0 COMMENT '是否公开：0-私有，1-公开',
  `like_count` INT DEFAULT 0 COMMENT '点赞数',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_question_id` (`question_id`),
  INDEX `idx_is_public` (`is_public`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户笔记表';
```

### 3.3 收藏表 (interview_collection)

```sql
CREATE TABLE `interview_collection` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `folder_id` BIGINT DEFAULT 0 COMMENT '收藏夹ID，0表示默认收藏夹',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '收藏时间',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_user_question` (`user_id`, `question_id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_question_id` (`question_id`),
  INDEX `idx_folder_id` (`folder_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收藏表';
```

### 3.4 收藏夹表 (interview_collection_folder)

```sql
CREATE TABLE `interview_collection_folder` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `folder_name` VARCHAR(100) NOT NULL COMMENT '收藏夹名称',
  `description` TEXT COMMENT '描述',
  `question_count` INT DEFAULT 0 COMMENT '题目数量',
  `is_default` TINYINT DEFAULT 0 COMMENT '是否默认收藏夹：0-否，1-是',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '逻辑删除：0-未删除，1-已删除',
  PRIMARY KEY (`id`),
  INDEX `idx_user_id` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='收藏夹表';
```

## 4. 批量导入相关表

### 4.1 导入任务表 (interview_import_task)

```sql
CREATE TABLE `interview_import_task` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `task_name` VARCHAR(200) NOT NULL COMMENT '任务名称',
  `source_path` VARCHAR(500) NOT NULL COMMENT '源文件路径',
  `total_files` INT DEFAULT 0 COMMENT '总文件数',
  `success_count` INT DEFAULT 0 COMMENT '成功导入数',
  `fail_count` INT DEFAULT 0 COMMENT '失败数',
  `skip_count` INT DEFAULT 0 COMMENT '跳过数',
  `task_status` TINYINT DEFAULT 0 COMMENT '任务状态：0-待执行，1-执行中，2-成功，3-失败，4-部分成功',
  `error_message` TEXT COMMENT '错误信息',
  `start_time` DATETIME COMMENT '开始时间',
  `end_time` DATETIME COMMENT '结束时间',
  `create_by` BIGINT COMMENT '创建人ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  INDEX `idx_task_status` (`task_status`),
  INDEX `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='导入任务表';
```

### 4.2 导入日志表 (interview_import_log)

```sql
CREATE TABLE `interview_import_log` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `task_id` BIGINT NOT NULL COMMENT '任务ID',
  `file_path` VARCHAR(500) NOT NULL COMMENT '文件路径',
  `file_name` VARCHAR(200) NOT NULL COMMENT '文件名',
  `category_name` VARCHAR(100) COMMENT '分类名称',
  `import_status` TINYINT DEFAULT 0 COMMENT '导入状态：0-待处理，1-成功，2-失败，3-跳过',
  `question_id` BIGINT COMMENT '导入成功后的题目ID',
  `error_message` TEXT COMMENT '错误信息',
  `process_time` INT COMMENT '处理时长（毫秒）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  INDEX `idx_task_id` (`task_id`),
  INDEX `idx_import_status` (`import_status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='导入日志表';
```

## 5. 统计和辅助表

### 5.1 学习统计表 (interview_study_statistics)

```sql
CREATE TABLE `interview_study_statistics` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `stat_date` DATE NOT NULL COMMENT '统计日期',
  `total_study_count` INT DEFAULT 0 COMMENT '总学习题目数',
  `new_study_count` INT DEFAULT 0 COMMENT '新学习题目数',
  `review_count` INT DEFAULT 0 COMMENT '复习题目数',
  `mastery_count` INT DEFAULT 0 COMMENT '掌握题目数',
  `study_duration` INT DEFAULT 0 COMMENT '学习时长（秒）',
  `category_distribution` JSON COMMENT '分类分布（JSON格式）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_user_date` (`user_id`, `stat_date`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_stat_date` (`stat_date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='学习统计表';
```

### 5.2 题目版本历史表 (interview_question_version)

```sql
CREATE TABLE `interview_question_version` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `version_no` INT NOT NULL COMMENT '版本号',
  `title` VARCHAR(500) NOT NULL COMMENT '题目标题',
  `content` LONGTEXT NOT NULL COMMENT '题目内容',
  `change_log` TEXT COMMENT '变更说明',
  `create_by` BIGINT COMMENT '创建人ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `uk_question_version` (`question_id`, `version_no`),
  INDEX `idx_question_id` (`question_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='题目版本历史表';
```

### 5.3 浏览历史表 (interview_browse_history)

```sql
CREATE TABLE `interview_browse_history` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `question_id` BIGINT NOT NULL COMMENT '题目ID',
  `category_id` BIGINT NOT NULL COMMENT '分类ID',
  `browse_time` DATETIME NOT NULL COMMENT '浏览时间',
  `duration` INT DEFAULT 0 COMMENT '浏览时长（秒）',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_question_id` (`question_id`),
  INDEX `idx_browse_time` (`browse_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='浏览历史表';
```

## 6. 索引优化策略

### 6.1 核心查询索引
```sql
-- 分类下的题目查询
ALTER TABLE interview_question ADD INDEX idx_category_status_sort (`category_id`, `status`, `sort_order`);

-- 用户学习进度查询
ALTER TABLE interview_study_progress ADD INDEX idx_user_status_time (`user_id`, `study_status`, `last_study_time`);

-- 标签查询优化
ALTER TABLE interview_question_tag ADD INDEX idx_tag_question (`tag_id`, `question_id`);
```

### 6.2 全文搜索索引
```sql
-- 题目全文搜索
ALTER TABLE interview_question ADD FULLTEXT INDEX ft_search (`title`, `content`) WITH PARSER ngram;

-- 笔记搜索
ALTER TABLE interview_user_note ADD FULLTEXT INDEX ft_note (`note_content`) WITH PARSER ngram;
```

## 7. 数据初始化

### 7.1 默认分类数据
```sql
-- 插入顶级分类
INSERT INTO interview_category (category_name, parent_id, sort_order) VALUES 
('Java基础', 0, 1),
('Java并发', 0, 2),
('JVM', 0, 3),
('Spring', 0, 4),
('数据库', 0, 5),
('Redis', 0, 6),
('消息队列', 0, 7),
('分布式', 0, 8),
('微服务', 0, 9),
('设计模式', 0, 10);
```

### 7.2 默认标签数据
```sql
-- 插入常用标签
INSERT INTO interview_tag (tag_name, tag_type) VALUES 
('高频', 1),
('大厂', 2),
('阿里', 2),
('腾讯', 2),
('字节', 2),
('美团', 2),
('后端', 3),
('架构师', 3),
('必背', 4),
('经典', 4);
```

## 8. 性能优化建议

### 8.1 分区策略
- interview_browse_history按月分区
- interview_study_statistics按月分区
- interview_import_log按任务ID范围分区

### 8.2 读写分离
- 主库处理写操作
- 从库处理统计查询和报表
- 缓存热点数据到Redis

### 8.3 定期维护
- 定期清理过期的浏览历史
- 定期更新统计数据
- 定期优化表和索引

## 9. 备份策略

### 9.1 备份计划
- 全量备份：每周日凌晨2点
- 增量备份：每天凌晨3点
- 关键表实时同步到备份库

### 9.2 恢复策略
- RPO（恢复点目标）：1小时
- RTO（恢复时间目标）：2小时
- 定期进行恢复演练

---

文档版本：v1.0
更新时间：2025-09-25
作者：Blog System Team
